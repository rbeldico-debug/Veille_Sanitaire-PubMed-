#### ADR-007 (Révisé) : Configuration Centralisée via Google Sheets

*   **Statut** : Accepté
*   **Contexte** : Les utilisateurs doivent pouvoir définir des veilles sans toucher au code ni manipuler de JSON. Ils sont déjà familiers avec Excel/Sheets.
*   **Décision** : Utiliser un onglet dédié nommé **`_ADMIN_CONFIG`** (le tiret bas pour le mettre au début) dans le Google Sheet Maître.
*   **Fonctionnement** :
    *   Au démarrage, le script lit cet onglet.
    *   Chaque ligne non-vide représente une "Tâche" (Job).
    *   Le script itère sur chaque ligne pour lancer les veilles séquentiellement (La "Queue").
*   **Colonnes de l'onglet `_ADMIN_CONFIG`** :
    1.  **Active** (Case à cocher ou OUI/NON) : Permet de désactiver une veille sans la supprimer.
    2.  **Nom de la Veille** : Deviendra le nom de l'onglet de résultat (ex: "Grippe Aviaire").
    3.  **Requête (Query)** : Les mots clés (ex: `H5N1 AND France`).
    4.  **Nb Max** : `retmax` (ex: 10).
    5.  **Jours Récents** : `reldate` (ex: 30). Si vide, on prend tout.
    6.  **Date Début** (`mindate`) : Optionnel.
    7.  **Date Fin** (`maxdate`) : Optionnel.
*   **Conséquences** :
    *   (+) **Autonomie totale** : Les collègues ajoutent une ligne, et le lendemain matin, leur onglet est créé et rempli.
    *   (+) **Zéro fichier** : Pas de fichier de config à gérer sur le serveur/PC.

#### ADR-008 : Stratégie de Construction de Requête Hybride

*   **Statut** : Accepté
*   **Contexte** : Il faut concilier simplicité (dates) et puissance (mots-clés complexes).
*   **Décision** : Le programme construira l'appel API en mélangeant :
    1.  La colonne "Requête" (brute) pour le contenu sémantique.
    2.  Les colonnes "Dates" pour paramétrer techniquement l'appel (`datetype='edat'`, `mindate`, etc.).
*   **Gestion des Dates** : Si l'utilisateur remplit "Jours Récents", cela prévaut sur "Date Début/Fin". Cela simplifie la logique utilisateur.

#### ADR-009 : Logging Rotatif (Confirmé)

*   **Statut** : Accepté
*   **Détail** : Implémentation via `logging.handlers.RotatingFileHandler`. Fichier `execution.log`. En cas d'erreur sur une ligne du Config Sheet (ex: requête mal formée), l'erreur est logguée, et le script passe à la ligne suivante (ne plante pas toute la chaîne).

---

### 3. À quoi va ressembler votre Google Sheet "Maître"

Je vous suggère de préparer votre Google Sheet avec cette structure pour le prochain test.

**Onglet 1 : `_ADMIN_CONFIG`**

| Active (A) | Nom Veille (B) | Requête (C) | Nb Max (D) | Jours Récents (E) | Date Début (F) | Date Fin (G) |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| TRUE | Psychiatrie | Psychiatry[MeSH] | 20 | 5 | | |
| TRUE | Pr. Dupont | Dupont J[Author] | 10 | | 2013/05/01 | 2013/06/01 |
| FALSE | Test | COVID-19 | 5 | 1 | | |

**Onglet 2 : `Psychiatrie`** (Créé automatiquement par le script)
*(Contiendra les résultats de la ligne 1)*

**Onglet 3 : `Pr. Dupont`** (Créé automatiquement par le script)
*(Contiendra les résultats de la ligne 2)*

---
